{"link": "https://codeforces.com//contest/1736/problem/C2", "problemId": "1577265", "problem_idx": "C2", "shortId": "1736C2", "contest_number": "1736", "problem_submissions": {"E": [175439543, 175443144, 175439009, 175381843, 175414723, 175438942, 175435995, 175434845, 177930000, 177929986, 175687203], "D": [175408404, 175400381, 175399625, 175411756, 175427268, 175403943, 175421797, 175410165, 175420142, 175417359, 175431513, 175416878, 175409927, 175413453, 175413865, 175431461, 175406398, 175441942], "C2": [175404703, 175417134, 175428380, 175419086, 175400852, 175397797, 175413006, 175423651, 175672172, 175406068, 175417021, 175434137, 175436814, 175434363, 175440989, 175420969, 175442300, 175419890], "C1": [175375043, 175383497, 175388568, 175387787, 175381377, 175379153, 175385345, 175386512, 175389788, 175382936, 175394942, 175375823, 175386767, 175379821, 175383900, 175387961, 175384170, 175389585, 175383234, 175389212], "B": [175370992, 175375317, 175373666, 175375194, 175374090, 175375063, 175373551, 175376722, 175374704, 175379058, 175374978, 175547536, 175411882, 175380763, 175374446, 175376075, 175375873, 175378999, 175381698, 175373819, 175381759], "A": [175370153, 175370410, 175370431, 175371396, 175370206, 175371113, 175370213, 175370596, 175371197, 175370850, 175370966, 175408706, 175371169, 175370108, 175370575, 175370376, 175370794, 175373232, 175370222, 175370303]}, "name": "C2. Good Subarrays  Hard Version ", "statement": "An array b of length m is if for all i the i-th element is greater than\r\nor equal to i. In other words, b is if and only if b_i\r\ngeq i for all i (1\r\nleq i\r\nleq m).You are given an array a consisting of n positive integers, and\r\nyou are asked q queries. In each query, you are given two integers p and\r\nx (1\r\nleq p,x\r\nleq n). You have to do a_p := x (assign x to a_p). In the updated array,\r\nfind the number of pairs of indices (l, r), where 1\r\nle l\r\nle r\r\nle n, such that the array [a_l, a_{l+1},\r\nldots, a_r] is .Note that all queries are , which means after each\r\nquery, the initial array a is restored.\r\n", "solutions": ["//\u8fd9\u56de\u53ea\u82b1\u4e86114514min\u5c31\u6253\u5b8c\u4e86\u3002\n//\u771f\u597d\u3002\u8bb0\u5f97\u591a\u624b\u9020\u51e0\u7ec4\u3002ACM\u62cd\u4ec0\u4e48\u62cd\u3002 \n#include \"bits/stdc++.h\"\nusing namespace std;\ntemplate<typename typC,typename typD> istream &operator>>(istream &cin,pair<typC,typD> &a) { return cin>>a.first>>a.second; }\ntemplate<typename typC> istream &operator>>(istream &cin,vector<typC> &a) { for (auto &x:a) cin>>x; return cin; }\ntemplate<typename typC,typename typD> ostream &operator<<(ostream &cout,const pair<typC,typD> &a) { return cout<<a.first<<' '<<a.second; }\ntemplate<typename typC,typename typD> ostream &operator<<(ostream &cout,const vector<pair<typC,typD>> &a) { for (auto &x:a) cout<<x<<'\\n'; return cout; }\ntemplate<typename typC> ostream &operator<<(ostream &cout,const vector<typC> &a) { int n=a.size(); if (!n) return cout; cout<<a[0]; for (int i=1; i<n; i++) cout<<' '<<a[i]; return cout; }\ntemplate<typename typC> bool cmin(typC &x,const typC &y) { if (x>y) { x=y; return 1; } return 0; }\ntemplate<typename typC> bool cmax(typC &x,const typC &y) { if (x<y) { x=y; return 1; } return 0; }\n#if !defined(ONLINE_JUDGE)&&defined(LOCAL)\n#include \"my_header\\debug.h\"\n#else\n#define dbg(...) ;\n#define dbgn(...) ;\n#endif\ntypedef unsigned int ui;\ntypedef long long ll;\n#define all(x) (x).begin(),(x).end()\n// void inc(ui &x,const ui &y) { if ((x+=y)>=p) x-=p; }\n// void dec(ui &x,const ui &y) { if ((x+=p-y)>=p) x-=p; }\nconst int N=1e6+5;\nvector<int> lg(2);\ntemplate <typename T> struct mintable\n{\n\tvector<T> a;\n\tvector<vector<T>> st;\n\tmintable(const vector<T> &b):a(all(b))\n\t{\n\t\tint n=a.size(),i,j,k,r;\n\t\twhile (lg.size()<=n) lg.push_back(lg[lg.size()>>1]+1);\n\t\tst.assign(lg[n]+1,vector<T>(n));\n\t\tiota(all(st[0]),0);\n\t\tfor (j=1; j<=lg[n]; j++)\n\t\t{\n\t\t\tr=n-(1<<j);\n\t\t\tk=1<<j-1;\n\t\t\tfor (i=0; i<=r; i++) st[j][i]=a[st[j-1][i]]<a[st[j-1][i+k]]?st[j-1][i]:st[j-1][i+k];\n\t\t}\n\t}\n\tT rmq(int l,int r) const\n\t{\n\t\tassert(0<=l&&l<=r&&r<a.size());\n\t\tint z=lg[r-l+1];\n\t\treturn min(a[st[z][l]],a[st[z][r-(1<<z)+1]]);\n\t}\n\tint rmp(int l,int r) const\n\t{\n\t\tassert(0<=l&&l<=r&&r<a.size());\n\t\tint z=lg[r-l+1];\n\t\treturn a[st[z][l]]<a[st[z][r-(1<<z)+1]]?st[z][l]:st[z][r-(1<<z)+1];\n\t}\n};\ntemplate<typename typC> struct bit\n{\n\tvector<typC> a;\n\tint n;\n\tbit() {}\n\tbit(int nn):n(nn),a(nn+1) {}\n\ttemplate<typename T> bit(int nn,T *b):n(nn),a(nn+1)\n\t{\n\t\tfor (int i=1; i<=n; i++) a[i]=b[i];\n\t\tfor (int i=1; i<=n; i++) if (i+(i&-i)<=n) a[i+(i&-i)]+=a[i];\n\t}\n\tvoid add(int x,typC y)\n\t{\n\t\t++x;\n\t\t//cerr<<\"add \"<<x<<\" by \"<<y<<endl;\n\t\tassert(1<=x&&x<=n);\n\t\ta[x]+=y;\n\t\twhile ((x+=x&-x)<=n) a[x]+=y;\n\t}\n\ttypC sum(int x)\n\t{\n\t\t++x;\n\t\t//cerr<<\"sum \"<<x;\n\t\tassert(0<=x&&x<=n);\n\t\ttypC r=a[x];\n\t\twhile (x^=x&-x) r+=a[x];\n\t\t//cerr<<\"= \"<<r<<endl;\n\t\treturn r;\n\t}\n\ttypC sum(int x,int y)\n\t{\n\t\treturn sum(y)-sum(x-1);\n\t}\n};\nint main()\n{\n\tios::sync_with_stdio(0); cin.tie(0);\n\tcout<<setiosflags(ios::fixed)<<setprecision(15);\n\tint n,m,i,j,k;\n\tcin>>n;\n\tvector<int> a(n),f(n),g(n);\n\tcin>>a;\n\tfor (i=0; i<n; i++) a[i]-=i;\n\tmintable s(a);\n\tll ans=0;\n\t// dbg(a);\n\tfor (i=0; i<n; i++)\n\t{\n\t\tint l=i-1,r=n-1,mid;\n\t\twhile (l<r)\n\t\t{\n\t\t\tmid=l+r+1>>1;\n\t\t\tif (s.rmq(i,mid)>=1-i) l=mid; else r=mid-1;\n\t\t}\n\t\tans+=l-i+1;\n\t\tf[i]=l;\n\t\t++l;\n\t\tr=n-1;\n\t\twhile (l<r)\n\t\t{\n\t\t\tmid=l+r+1>>1;\n\t\t\tif (s.rmq(f[i]+2,mid)>=1-i) l=mid; else r=mid-1;\n\t\t}\n\t\tg[i]=l;\n\t}\n\tcin>>m;\n\tvector<vector<pair<int,int>>> q(n);\n\tvector<ll> res(m);\n\tfor (i=0; i<m; i++)\n\t{\n\t\tint p,x;\n\t\tcin>>p>>x;\n\t\tq[p-1].push_back({x,i});\n\t}\n\t// dbg(f);\n\t// dbg(ans);\n\t// dbg(g);\n\tbit<ll> t(n),tt(n);\n\tfor (i=0,j=0; i<n; i++)\n\t{\n\t\tint R=j;\n\t\twhile (R<n&&f[R]==i-1) ++R;\n\t\ttt.add(i,f[i]);\n\t\tfor (k=j; k<R; k++) t.add(k,g[k]-f[k]),tt.add(k,-f[k]);\n\t\tfor (auto [x,id]:q[i])\n\t\t{\n\t\t\tx-=i;\n\t\t\tif (x>=a[i])\n\t\t\t{\n\t\t\t\tres[id]=ans+t.sum(min(n,max(0,1-x)),n-1);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tint L=max(R-1,min(-x,i));\n\t\t\t\t// dbg(L,R,i);\n\t\t\t\tres[id]=ans-(tt.sum(R,L)-(ll)(L-R+1)*(i-1));\n\t\t\t}\n\t\t}\n\t\tfor (k=j; k<R; k++) t.add(k,f[k]-g[k]);\n\t\tj=R;\n\t}\n\tfor (ll x:res) cout<<x<<'\\n';\n}\n"], "input": "", "output": "", "tags": ["binary search", "data structures", "dp", "two pointers"], "dificulty": "2400", "interactive": false}
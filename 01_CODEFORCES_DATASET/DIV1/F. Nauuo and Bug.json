{
    "link": "https://codeforces.com//contest/1172/problem/F",
    "problemId": "355014",
    "problem_idx": "F",
    "shortId": "1172F",
    "contest_number": "1172",
    "problem_submissions": {
        "C2": [
            141600407,
            55254783,
            55254826,
            55257297,
            55253043,
            55256695,
            55259217,
            55259307,
            55260348,
            55256683,
            55270942,
            55262864,
            55394593,
            55256544,
            55256222,
            55256476
        ],
        "D": [
            55259812,
            55261379,
            55260385,
            55262554,
            55264421,
            55262846,
            55265864,
            55262949,
            55261237,
            55257268,
            55265259,
            55282819,
            55259099,
            55263111,
            55263637,
            55264769,
            55252234,
            55272471
        ],
        "C1": [
            55254052,
            55254936,
            55255627,
            55253139,
            55256736,
            55258621,
            55259255,
            55260376,
            55255981,
            55261688,
            55260260,
            55262975,
            55258783,
            55259505,
            55261611,
            55269127,
            55256504,
            55255804,
            55256553
        ],
        "B": [
            55249856,
            55248174,
            55250922,
            55254795,
            55250751,
            55252004,
            55254040,
            55251691,
            55250951,
            55253498,
            55253667,
            55248941,
            55252605,
            55253983,
            55255049,
            55260189,
            55249359,
            55251616,
            55252768
        ],
        "A": [
            55248325,
            55257508,
            55248960,
            55257490,
            55247357,
            55248700,
            55251742,
            55266272,
            55607192,
            55249619,
            55249678,
            55256938,
            55249251,
            55250622,
            55258815,
            55257623,
            55247019,
            55249926,
            55249357
        ],
        "E": [
            99401668,
            55317241,
            55479078,
            55479032,
            55478977
        ],
        "F": [
            55517893,
            55302923,
            55292935,
            55545710
        ]
    },
    "name": "F. Nauuo and Bug",
    "statement": "Nauuo is a girl who loves coding.One day she was solving a problem which\r\nrequires to calculate a sum of some numbers modulo p.She wrote the\r\nfollowing code and got the verdict \"Wrong answer\".She soon discovered\r\nthe bug the function only worked for numbers in the range [0,p), but the\r\nnumbers in the problem may be out of the range. She was curious about\r\nthe wrong function, so she wanted to know the result of it.However, the\r\noriginal code worked too slow, so she asked you to help her.You are\r\ngiven an array a_1,a_2,\r\nldots,a_n and a number p. Nauuo will make m queries, in each query, you\r\nare given l and r, and you have to calculate the results of . You can\r\nsee the definition of the function in the pseudocode above.Note that the\r\nintegers won\u2019t overflow in the code above.\r\n",
    "solutions": [
        "#include <bits/stdc++.h>\nusing namespace std;\n\nusing ll=long long;\n#define int ll\n\n#define rng(i,a,b) for(int i=int(a);i<int(b);i++)\n#define rep(i,b) rng(i,0,b)\n#define gnr(i,a,b) for(int i=int(b)-1;i>=a;i--)\n#define per(i,b) gnr(i,0,b)\n#define pb push_back\n#define eb emplace_back\n#define a first\n#define b second\n#define bg begin()\n#define ed end()\n#define all(x) x.bg,x.ed\n#ifdef LOCAL\n#define dmp(x) cerr<<__LINE__<<\" \"<<#x<<\" \"<<x<<endl\n#else\n#define dmp(x) void(0)\n#endif\n\ntemplate<class t,class u> void chmax(t&a,u b){if(a<b)a=b;}\ntemplate<class t,class u> void chmin(t&a,u b){if(a>b)a=b;}\n\ntemplate<class t> using vc=vector<t>;\ntemplate<class t> using vvc=vc<vc<t>>;\n\nusing pi=pair<int,int>;\nusing vi=vc<int>;\n\ntemplate<class t,class u>\nostream& operator<<(ostream& os,const pair<t,u>& p){\n\treturn os<<\"{\"<<p.a<<\",\"<<p.b<<\"}\";\n}\n\ntemplate<class t> ostream& operator<<(ostream& os,const vc<t>& v){\n\tos<<\"{\";\n\tfor(auto e:v)os<<e<<\",\";\n\treturn os<<\"}\";\n}\n\ntemplate<class t> void mkuni(vc<t>&v){\n\tsort(all(v));\n\tv.erase(unique(all(v)),v.ed);\n}\n\nll read(){ll i;cin>>i;return i;}\n\nconst int inf=LLONG_MAX/3;\n\nint p;\n\nstruct N{\n\tvi x;\n\tint s;\n\tvoid init(int a){\n\t\tx={-inf,p-a,inf};\n\t\ts=a;\n\t}\n\tvoid mrg(const N&a,const N&b){\n\t\tint len=a.x.size()+b.x.size()-4;\n\t\tx.pb(-inf);\n\t\tint c=0,d=0;\n\t\trng(num,1,len+1){\n\t\t\tint cur=x.back();\n\t\t\twhile(c+d<num){\n\t\t\t\tint nx=min(a.x[c+1]-cur,b.x[d+1]-(cur+a.s-c*p));\n\t\t\t\tcur+=nx;\n\t\t\t\tif(a.x[c+1]<=cur)c++;\n\t\t\t\tif(d)d--;\n\t\t\t\twhile(b.x[d+1]<=cur+a.s-c*p)d++;\n\t\t\t}\n\t\t\tx.pb(cur);\n\t\t}\n\t\tx.pb(inf);\n\t\ts=a.s+b.s;\n\t}\n\tint get(int v){\n\t\treturn v+s-(upper_bound(all(x),v)-x.bg-1)*p;\n\t}\n};\n\nstruct S{\n\tvc<N> buf;\n\tint s;\n\tS(vi d){\n\t\ts=1;\n\t\twhile(s<int(d.size()))s*=2;\n\t\td.resize(s);\n\t\tbuf.resize(s*2);\n\t\trep(i,s)\n\t\t\tbuf[i+s].init(d[i]);\n\t\tgnr(i,1,s)\n\t\t\tbuf[i].mrg(buf[i*2],buf[i*2+1]);\n\t}\n\tvoid get(int b,int e,int&v,int l,int r,int i){\n\t\tif(e<=l||r<=b)return;\n\t\tif(b<=l&&r<=e){\n\t\t\tv=buf[i].get(v);\n\t\t\treturn;\n\t\t}\n\t\tint m=(l+r)/2;\n\t\tget(b,e,v,l,m,i*2);\n\t\tget(b,e,v,m,r,i*2+1);\n\t}\n\tint get(int b,int e){\n\t\tint v=0;\n\t\tget(b,e,v,0,s,1);\n\t\treturn v;\n\t}\n};\n\nsigned main(){\n\tcin.tie(nullptr);\n\tios::sync_with_stdio(false);\n\tcout<<fixed<<setprecision(20);\n\t\n\tint n=read(),m=read();\n\tp=read();\n\tvi a(n);\n\trep(i,n)a[i]=read();\n\tS slv(a);\n\t\n\trep(_,m){\n\t\tint l=read()-1,r=read();\n\t\tcout<<slv.get(l,r)<<\"\\n\";\n\t}\n}\n"
    ],
    "input": "",
    "output": "",
    "tags": [
        "data structures"
    ],
    "dificulty": "3300",
    "interactive": false,
    "file_name": "D:\\scoala\\RESEARCH\\MLCP\\01_CODEFORCES_DATASET\\DIV1\\F. Nauuo and Bug.json",
    "editorial_link": "https://codeforces.com//blog/entry/67511",
    "editorial": "TutorialAt first, let\u00e2\u0080\u0099s solve this problem in .Let\u00e2\u0080\u0099s split our array\r\ninto blocks by integers, and let\u00e2\u0080\u0099s find a function, which value you will\r\nget at the end of the current block if you will start with . With simple\r\ninduction, you can prove that this function is a piece-wise linear, and\r\nit has segments, so you can build it iteratively in time for each block,\r\nso the preprocessing took .And to answer the query, you can keep the\r\ncurrent value of and then find with binary search by that piece-wise\r\nlinear function the for the current block.With a good choice of , this\r\nsolution will work in .Ok, but then how to solve it in ?Lemma: each\r\nsegment of this piece-wise linear function has length at least .You can\r\nprove it with simple induction.And then, with this lemma, it is possible\r\nby two functions of size and of size find the new function , in the ,\r\nyou can do it with two pointers, similar to the previous iterative\r\nmethod, but adding a several points to the function each time, best way\r\nto understand it is to check the indendent solution :)\r\n"
}